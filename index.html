<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Auto Lot Calc v17.5</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <style>
        body {
            background: #121212;
            color: #f5f5f5;
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            margin: 0;
            overflow-y: auto;
        }

        .card {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
            display: block;
            font-weight: 600;
        }

        .value {
            font-size: 22px;
            font-weight: 700;
            color: #fff;
        }

        .mono {
            font-family: "Roboto Mono", monospace;
            letter-spacing: -0.5px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .col {
            display: flex;
            flex-direction: column;
        }

        input,
        select,
        button {
            width: 100%;
            box-sizing: border-box;
            padding: 14px;
            background: #2a2a2a;
            border: 1px solid #333;
            color: #fff;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            -webkit-appearance: none;
        }

        input:focus,
        select:focus {
            border-color: #448aff;
            background: #333;
        }

        .select-wrapper {
            position: relative;
            width: 100%;
        }

        .select-btn {
            width: 100%;
            padding: 14px;
            background: #2a2a2a;
            border: 1px solid #333;
            color: #fff;
            border-radius: 12px;
            font-size: 18px;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        .native-select {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }

        .star-btn {
            width: 54px;
            height: 54px;
            flex-shrink: 0;
            background: #2a2a2a;
            border: 1px solid #333;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: #555;
            cursor: pointer;
        }

        .star-btn.active {
            color: #448aff;
            border-color: #448aff;
            background: rgba(68, 138, 255, 0.15);
        }

        button.trade {
            border: none;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
            color: #fff;
            transition: 0.3s;
        }

        button.trade.buy {
            background: linear-gradient(135deg, #2962ff, #448aff);
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.4);
        }

        button.trade.sell {
            background: linear-gradient(135deg, #d50000, #ff5252);
            box-shadow: 0 4px 15px rgba(213, 0, 0, 0.4);
        }

        button.trade:disabled {
            background: #333;
            color: #555;
        }

        .side-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .side-btn {
            flex: 1;
            padding: 12px;
            background: #333;
            border: 2px solid transparent;
            border-radius: 12px;
            font-weight: bold;
            color: #888;
            text-align: center;
            cursor: pointer;
        }

        .side-btn.buy.active {
            background: rgba(41, 98, 255, 0.2);
            color: #448aff;
            border-color: #448aff;
        }

        .side-btn.sell.active {
            background: rgba(213, 0, 0, 0.2);
            color: #ff5252;
            border-color: #ff5252;
        }

        .toggle-row {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }

        .toggle-btn {
            flex: 1;
            padding: 8px;
            font-size: 12px;
            background: #333;
            border: 1px solid #444;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
        }

        .toggle-btn.active {
            background: #448aff;
            color: #fff;
            border-color: #448aff;
            font-weight: bold;
        }

        #modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: #1e1e1e;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            max-width: 85%;
            border: 1px solid #333;
            width: 90%;
            height: 80%;
            overflow: auto;
        }

        .disclaimer {
            font-size: 11px;
            color: #ffb74d;
            background: #332b00;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #ffb74d;
            margin-top: 10px;
            line-height: 1.4;
        }

        .sl-mode-toggle {
            display: flex;
            font-size: 10px;
            background: #333;
            border-radius: 6px;
            overflow: hidden;
            margin-left: auto;
        }

        .sl-mode-btn {
            padding: 4px 8px;
            cursor: pointer;
            color: #888;
        }

        .sl-mode-btn.active {
            background: #448aff;
            color: #fff;
            font-weight: bold;
        }

        .input-grp {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .input-card {
            flex: 1;
            min-width: 90px;
            margin: 0;
            padding: 12px;
            background: #252525;
            box-sizing: border-box;
            border-radius: 12px;
        }

        .input-card input {
            padding: 8px 10px;
            font-size: 16px;
            height: 40px;
        }

        .detected-comm {
            font-size: 10px;
            color: #00e676;
            margin-top: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .detected-comm span {
            background: rgba(0, 230, 118, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        #debug_info {
            font-size: 9px;
            color: #444;
            margin-top: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
    </style>

    <script>
        function P(obj, key) {
            if (!obj) return undefined;
            if (obj[key] !== undefined) return obj[key];
            const pascal = key.charAt(0).toUpperCase() + key.slice(1);
            if (obj[pascal] !== undefined) return obj[pascal];
            const camel = key.charAt(0).toLowerCase() + key.slice(1);
            if (obj[camel] !== undefined) return obj[camel];
            return undefined;
        }

        const App = {
            account: "---",
            balance: 0,
            currency: "",
            assetId: null,
            allSymbols: [],
            symbol: null,
            bid: 0,
            ask: 0,
            spread: 0,
            volCents: 0,
            volLots: 0,
            tradeSide: 1,
            showFavs: false,
            slMode: "pips",
            localFavs: [],
            ready: false,
            pendingComm: null,
            lastRawQuote: null
        };

        const Tunnel = {
            queue: new Map(),
            send: (id, pl, cb) => {
                const mid = "req-" + id + "-" + Date.now() + Math.random().toString(36).substr(2, 5);
                if (cb) Tunnel.queue.set(mid, cb);
                const w = { payloadType: 2100, clientMsgId: "w-" + mid, payload: { payloadType: id, clientMsgId: mid, payload: pl || {} } };
                try { window.EventBasedPluginJavaScriptBridge.handlePluginEvent(JSON.stringify(w)); } catch (e) { }
            },
            onMsg: (w) => {
                let inn = null;
                try {
                    if (w.payloadType === 2101 || w.payloadType === 2102) {
                        const py = w.payload;
                        inn = (py && py.data && typeof py.data === 'string') ? JSON.parse(py.data) : py;
                    }
                } catch (e) { }
                if (!inn) return;
                const mid = P(inn, "clientMsgId");
                const pl = P(inn, "payload");
                if (mid && Tunnel.queue.has(mid)) { Tunnel.queue.get(mid)(pl); Tunnel.queue.delete(mid); }
                const type = P(inn, "payloadType");
                if (type === 3 || type === "PROTO_QUOTE_EVENT") Logic.onQuote(inn.payload || inn);
            }
        };

        const Logic = {
            init: () => {
                window.addEventListener('message-from-host', e => {
                    const m = e.data;
                    if (m.payloadType === 2000) {
                        try { window.EventBasedPluginJavaScriptBridge.handlePluginEvent(JSON.stringify({ payloadType: 2001, clientMsgId: m.clientMsgId, payload: null })); } catch (e) { }
                        if (!App.ready) { App.ready = true; Logic.start(); }
                    } else { Tunnel.onMsg(m); }
                });
                ['in_risk', 'in_sl', 'in_comm'].forEach(id => {
                    document.getElementById(id).oninput = () => { Logic.saveSettings(); Logic.calc(); };
                });
                document.getElementById('btn_trade').onclick = Logic.trade;
                document.getElementById('native_sym').onchange = (e) => Logic.selectSym(e.target.value);
                document.getElementById('side_buy').onclick = () => Logic.setSide(1);
                document.getElementById('side_sell').onclick = () => Logic.setSide(2);
                document.getElementById('btn_star').onclick = Logic.toggleCurrentFav;
                Logic.loadSettings();
            },

            loadSettings: () => {
                try {
                    const s = localStorage.getItem('alc_settings');
                    if (s) {
                        const j = JSON.parse(s);
                        if (j.risk) document.getElementById('in_risk').value = j.risk;
                        if (j.sl) document.getElementById('in_sl').value = j.sl;
                        if (j.comm) document.getElementById('in_comm').value = j.comm;
                        if (j.showFavs !== undefined) App.showFavs = j.showFavs;
                        if (j.slMode) UI.setSLMode(j.slMode, true);
                        if (j.localFavs) App.localFavs = j.localFavs;
                    }
                } catch (e) { }
            },

            saveSettings: () => {
                try {
                    const s = {
                        risk: document.getElementById('in_risk').value,
                        sl: document.getElementById('in_sl').value,
                        comm: document.getElementById('in_comm').value,
                        showFavs: App.showFavs,
                        slMode: App.slMode,
                        localFavs: App.localFavs
                    };
                    localStorage.setItem('alc_settings', JSON.stringify(s));
                } catch (e) { }
            },

            toggleCurrentFav: () => {
                if (!App.symbol) return;
                const id = App.symbol.id;
                const idx = App.localFavs.indexOf(id);
                if (idx >= 0) App.localFavs.splice(idx, 1);
                else App.localFavs.push(id);
                UI.updateStar();
                Logic.saveSettings();
                if (App.showFavs) UI.renderSyms();
            },

            start: () => {
                document.getElementById('status').innerText = "ONLINE";
                document.getElementById('status').style.color = "#00e676";

                Tunnel.send(175, {}, res => {
                    const t = P(res, "trader");
                    if (t) {
                        App.account = P(t, "login");
                        App.balance = (P(t, "balance") || 0) / 100;
                        App.assetId = P(t, "depositAssetId") || P(res, "depositAssetId");
                        if (App.assetId === 6) App.currency = "JPY";
                        else if (App.assetId === 1) App.currency = "USD";
                        UI.updateAcc();
                        Logic.loadSyms();
                    }
                });
                Tunnel.send(176, {}, res => {
                    const cur = P(res, "depositCurrency");
                    if (cur) { App.currency = cur; UI.updateAcc(); }
                });
            },

            loadSyms: () => {
                Tunnel.send(841, { includeArchivedSymbols: false }, res => {
                    const s = P(res, "symbol");
                    if (s) {
                        s.sort((a, b) => P(a, "name").localeCompare(P(b, "name")));
                        App.allSymbols = s;
                        UI.renderSyms();
                        UI.toggleFav(App.showFavs);
                        if (!App.symbol && s.length > 0) Logic.selectSym(P(s[0], "id"));
                    }
                });
            },

            setSide: (s) => {
                App.tradeSide = s;
                const isBuy = (s === 1);
                document.getElementById('side_buy').className = isBuy ? "side-btn buy active" : "side-btn";
                document.getElementById('side_sell').className = !isBuy ? "side-btn sell active" : "side-btn";
                document.getElementById('btn_trade').className = isBuy ? "trade buy" : "trade sell";
                document.getElementById('btn_trade').innerText = isBuy ? "PLACE BUY ORDER" : "PLACE SELL ORDER";

                UI.updatePriceDisplay();
                Logic.calc();
            },

            convertSLInput: (newMode) => {
                if (!App.bid || !App.symbol) return;
                const current = (App.tradeSide === 1) ? (App.ask || App.bid) : App.bid;
                const val = parseFloat(document.getElementById('in_sl').value);
                const digits = P(App.symbol, "digits") || (P(App.symbol, "name").includes("JPY") ? 3 : 5);
                const pipPos = P(App.symbol, "pipPosition") || (digits === 3 ? 2 : 4);
                const pipSize = Math.pow(10, -pipPos);

                if (newMode === "price") {
                    let price = (App.tradeSide === 1) ? current - (val * pipSize) : current + (val * pipSize);
                    document.getElementById('in_sl').value = price.toFixed(digits);
                    document.getElementById('in_sl').step = pipSize;
                } else {
                    const pips = Math.abs(current - val) / pipSize;
                    document.getElementById('in_sl').value = Math.round(pips);
                    document.getElementById('in_sl').step = 1;
                }
            },

            selectSym: (id) => {
                if (!id) return;
                id = parseInt(id);
                const s = App.allSymbols.find(x => P(x, "id") === id);

                if (s) {
                    document.getElementById('sel_sym_name').innerText = P(s, "name");
                    App.symbol = s;
                    App.symbol.id = id;
                    App.bid = 0; App.ask = 0;

                    Tunnel.send(163, { symbolId: [id] }, res => {
                        const l = P(res, "symbol");
                        if (l && l[0]) {
                            App.symbol = Object.assign({}, App.symbol, l[0]);
                            App.symbol.id = id;

                            let rxLot = P(App.symbol, "lotSize") || 100000;
                            App.symbol._lotUnits = (rxLot > 500000) ? rxLot / 100 : rxLot;
                            App.symbol._lotCents = App.symbol._lotUnits * 100;
                            App.symbol._stepCents = P(App.symbol, "stepVolume") || 100000;

                            UI.updateStar();

                            // COMMISSION
                            let comm = P(App.symbol, "commission");
                            let cType = P(App.symbol, "commissionType") || "";
                            document.getElementById('comm_detect').innerHTML = "";

                            if (comm && cType.includes("PER_MILLION")) {
                                const perLot = (comm / 100) / 10;
                                if (cType.startsWith("USD") && App.currency === "JPY") App.pendingComm = perLot;
                                else Logic.setDetectedComm(perLot);
                            }
                            Logic.calc();
                        }
                    });
                    Tunnel.send(601, { symbolId: [id], subscribeToSpotTimestamp: true });
                    Logic.calc();
                }
            },

            setDetectedComm: (val) => {
                const v = Math.round(val);
                const lbl = document.getElementById('comm_detect');
                lbl.innerHTML = `<span>⚡ Detected: ${v}/Lot</span>`;
                lbl.onclick = () => { document.getElementById('in_comm').value = v; Logic.saveSettings(); Logic.calc(); };
            },

            onQuote: (q) => {
                const sid = P(q, "symbolId");
                if (App.symbol && P(App.symbol, "id") == sid) {
                    const bidRaw = P(q, "bid");
                    const askRaw = P(q, "ask");
                    const digits = P(App.symbol, "digits") || (P(App.symbol, "name").includes("JPY") ? 3 : 5);

                    App.lastRawQuote = { bid: bidRaw, ask: askRaw, digits: digits };

                    if (bidRaw) App.bid = bidRaw / 100000;
                    if (askRaw) App.ask = askRaw / 100000;
                    if (!App.ask && App.bid) App.ask = App.bid;

                    if (App.ask && App.bid) {
                        const pipPos = P(App.symbol, "pipPosition") || (digits === 3 ? 2 : 4);
                        const pipSize = Math.pow(10, -pipPos);
                        App.spread = (App.ask - App.bid) / pipSize;

                        if (App.pendingComm && App.currency === "JPY") {
                            Logic.setDetectedComm(App.pendingComm * App.bid);
                            App.pendingComm = null;
                        }

                        UI.updatePriceDisplay();
                        document.getElementById('debug_txt').innerText = `ID:${sid} Digits:${digits} RawBid:${bidRaw}`;
                        Logic.calc();
                    }
                }
            },

            calc: () => {
                if (!App.symbol || !App.bid) return;
                const r = parseFloat(document.getElementById('in_risk').value);
                let slInput = parseFloat(document.getElementById('in_sl').value);
                const comm = parseFloat(document.getElementById('in_comm').value) || 0;
                if (!r || !slInput) return;

                const digits = P(App.symbol, "digits") || (P(App.symbol, "name").includes("JPY") ? 3 : 5);
                const pipPos = P(App.symbol, "pipPosition") || (digits === 3 ? 2 : 4);
                const pipSize = Math.pow(10, -pipPos);

                const current = (App.tradeSide === 1) ? (App.ask || App.bid) : App.bid;
                let slPips = (App.slMode === "price") ? Math.abs(current - slInput) / pipSize : slInput;
                if (slPips < 0.1) slPips = 0.1;

                const riskAmt = App.balance * (r / 100);
                const sym = P(App.symbol, "name").toUpperCase();
                const acc = (App.currency || "").toUpperCase();

                let finalPipVal = 10;
                if (acc === "JPY") finalPipVal = 1000;
                else if (acc === "USD") {
                    if (sym.endsWith("USD")) finalPipVal = 10;
                    else if (sym.endsWith("JPY") && App.bid) finalPipVal = 1000 / App.bid;
                    else finalPipVal = 10;
                } else finalPipVal = App.symbol._lotUnits * pipSize;

                const lots = riskAmt / ((slPips * finalPipVal) + comm);
                let cents = Math.floor((lots * App.symbol._lotCents) / (App.symbol._stepCents || 100000)) * (App.symbol._stepCents || 100000);

                App.volCents = cents;
                App.volLots = cents / App.symbol._lotCents;
                UI.updateCalc(riskAmt, slPips, App.volLots * comm);
            },

            trade: () => {
                if (App.volCents <= 0 || !App.bid) return;
                const isBuy = (App.tradeSide === 1);
                const slInput = parseFloat(document.getElementById('in_sl').value);
                const digits = P(App.symbol, "digits") || (P(App.symbol, "name").includes("JPY") ? 3 : 5);
                const pipPos = P(App.symbol, "pipPosition") || (digits === 3 ? 2 : 4);
                const pipSize = Math.pow(10, -pipPos);

                let finalSLPips = (App.slMode === "price") ? Math.abs((isBuy ? App.ask : App.bid) - slInput) / pipSize : slInput;
                const relSL = Math.round((finalSLPips * pipSize) / 0.00001);

                document.getElementById('btn_trade').innerText = "...";
                document.getElementById('btn_trade').disabled = true;

                Tunnel.send(143, { symbolId: App.symbol.id, orderType: 1, tradeSide: App.tradeSide, volume: App.volCents, relativeStopLoss: relSL }, res => {
                    document.getElementById('btn_trade').innerText = "PLACE " + (isBuy ? "BUY" : "SELL") + " ORDER";
                    document.getElementById('btn_trade').disabled = false;
                    if (P(res, "errorCode")) UI.showModal("ERROR", P(res, "errorCode"));
                    else UI.showModal("SUCCESS", `Ordered ${App.volLots.toFixed(2)} Lots`);
                });
            }
        };

        const UI = {
            setSLMode: (mode, skip) => {
                if (!skip) Logic.convertSLInput(mode);
                App.slMode = mode;
                document.getElementById('btn_sl_pips').className = (mode === 'pips' ? 'sl-mode-btn active' : 'sl-mode-btn');
                document.getElementById('btn_sl_price').className = (mode === 'price' ? 'sl-mode-btn active' : 'sl-mode-btn');
                document.getElementById('lbl_sl').innerText = (mode === 'price' ? "SL Price" : "SL (Pips)");
                Logic.saveSettings(); Logic.calc();
            },
            toggleFav: (f) => {
                App.showFavs = (f !== undefined) ? f : !App.showFavs;
                Logic.saveSettings();
                document.getElementById('btn_all').className = App.showFavs ? 'toggle-btn' : 'toggle-btn active';
                document.getElementById('btn_fav').className = App.showFavs ? 'toggle-btn active' : 'toggle-btn';
                UI.renderSyms();
            },

            updatePriceDisplay: () => {
                if (!App.bid) return;
                const digits = P(App.symbol, "digits") || (P(App.symbol, "name").includes("JPY") ? 3 : 5);
                // Display Ask for BUY, Bid for SELL
                const price = (App.tradeSide === 1) ? (App.ask || App.bid) : App.bid;
                const sideLabel = (App.tradeSide === 1) ? "<span style='color:#448aff;font-size:10px;vertical-align:middle;margin-right:5px'>ASK</span>" : "<span style='color:#ff5252;font-size:10px;vertical-align:middle;margin-right:5px'>BID</span>";

                document.getElementById('lbl_price').innerHTML = `${sideLabel}${price.toFixed(digits)} <span style='font-size:12px;color:#888;margin-left:10px'>Spread: ${App.spread.toFixed(1)}</span>`;
            },

            updateStar: () => {
                if (!App.symbol) return;
                document.getElementById('btn_star').className = App.localFavs.includes(App.symbol.id) ? "star-btn active" : "star-btn";
            },
            updateAcc: () => {
                document.getElementById('acc_id').textContent = App.account;
                document.getElementById('acc_bal').textContent = Math.floor(App.balance).toLocaleString() + " " + App.currency;
            },
            renderSyms: () => {
                const el = document.getElementById('native_sym');
                let matches = App.showFavs ? App.allSymbols.filter(x => App.localFavs.includes(P(x, "id"))) : App.allSymbols;
                if (matches.length === 0) { el.innerHTML = "<option disabled>(None)</option>"; return; }
                el.innerHTML = "<option disabled>Select Pair...</option>" + matches.map(i => `<option value="${P(i, 'id')}"${P(i, 'id') === (App.symbol ? App.symbol.id : null) ? ' selected' : ''}>${P(i, 'name')}</option>`).join("");
            },
            updateCalc: (risk, pips, totalComm) => {
                document.getElementById('out_lots').innerHTML = App.volLots.toFixed(2) + " Lots";
                document.getElementById('out_lots').innerHTML += `<div style='font-size:12px;color:#888;margin-top:2px;'>(${pips.toFixed(1)} pips) Est. Comm: ${Math.round(totalComm)} ${App.currency}</div>`;
                document.getElementById('out_risk').textContent = "Risk: " + Math.floor(risk) + " " + App.currency;
                document.getElementById('btn_trade').disabled = (App.volCents <= 0);
            },
            showModal: (t, m) => {
                const mod = document.getElementById('modal');
                mod.style.display = "flex";
                mod.querySelector('.modal-content').innerHTML = `<h3 style="color:${t === 'SUCCESS' ? '#00e676' : '#ff5252'}">${t}</h3><div>${m}</div><button onclick="document.getElementById('modal').style.display='none'" style="margin-top:15px;background:#444">CLOSE</button>`;
            }
        };
        window.onload = Logic.init;
    </script>
</head>

<body>
    <div class="row" style="margin-bottom:10px">
        <div style="font-weight:900; font-size:18px; color:#448aff; letter-spacing:1px; cursor:pointer;"
            onclick="location.reload()">AUTO LOT<span style="color:#fff">CALC</span> v17.5</div>
        <div id="status" style="font-size:10px; font-weight:bold; color:#555">OFFLINE</div>
    </div>

    <div class="card" style="background: linear-gradient(135deg, #1e1e1e, #252525);">
        <div class="row">
            <div class="col"><span class="label">Balance</span>
                <div class="value mono" id="acc_bal">---</div>
            </div>
            <div class="col" style="align-items:flex-end"><span class="label">Account</span>
                <div class="value" id="acc_id" style="font-size:16px; color:#888;">---</div>
            </div>
        </div>
    </div>

    <div class="card">
        <span class="label">Trading Pair</span>
        <div class="toggle-row">
            <div id="btn_all" class="toggle-btn active" onclick="UI.toggleFav(false)">ALL</div>
            <div id="btn_fav" class="toggle-btn" onclick="UI.toggleFav(true)">★ FAVORITES</div>
        </div>
        <div class="row" style="gap:10px;">
            <div class="select-wrapper">
                <div class="select-btn"><span id="sel_sym_name">SELECT SYMBOL</span><span>▼</span></div><select
                    id="native_sym" class="native-select"></select>
            </div>
            <div id="btn_star" class="star-btn">★</div>
        </div>
        <div style="margin-top:15px; text-align:center;">
            <div class="value mono" id="lbl_price" style="font-size:28px; color:#aaa">---</div>
        </div>
    </div>

    <div class="side-row">
        <div id="side_buy" class="side-btn buy active">BUY</div>
        <div id="side_sell" class="side-btn sell">SELL</div>
    </div>

    <div class="input-grp">
        <div class="input-card" style="flex: 0.8"><span class="label">Risk %</span><input type="number" id="in_risk"
                value="1.0" step="0.1"></div>
        <div class="input-card" style="flex: 1.2">
            <div class="row"><span class="label" id="lbl_sl">SL (Pips)</span>
                <div class="sl-mode-toggle">
                    <div id="btn_sl_pips" class="sl-mode-btn active" onclick="UI.setSLMode('pips')">Pips</div>
                    <div id="btn_sl_price" class="sl-mode-btn" onclick="UI.setSLMode('price')">Price</div>
                </div>
            </div>
            <input type="number" id="in_sl" value="20" step="1">
        </div>
        <div class="input-card"><span class="label">Comm/Lot</span><input type="number" id="in_comm" value="600"
                step="10">
            <div id="comm_detect" class="detected-comm"></div>
        </div>
    </div>

    <div class="card" style="border: 1px solid #333;">
        <div class="row"><span class="label">Volume</span><span class="label" id="out_risk">Risk: 0</span></div>
        <div class="value mono" id="out_lots" style="font-size:36px; color:#448aff; margin:10px 0;">0.00 Lots</div>
        <button id="btn_trade" class="trade buy" disabled>PLACE BUY ORDER</button>
    </div>

    <div id="debug_info">
        <div>DEBUG MODE</div>
        <div id="debug_txt">Waiting for symbol...</div>
    </div>

    <div id="modal">
        <div class="modal-content"></div>
    </div>
</body>

</html>