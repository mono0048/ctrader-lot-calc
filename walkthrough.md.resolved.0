# AutoLotCalculator (cTrader版) 使用ガイド

MQL5から移植された「AutoLotCalculator」cBotの使用方法です。

## インストール手順

1.  cTraderを開き、「**Algo**」タブを選択します。
2.  「**New**」をクリックし、新しいcBotを作成します。名前は [AutoLotCalculator](file:///C:/Users/jf08/.gemini/antigravity/brain/4ed089b8-5f02-4200-a967-79e572b525cf/AutoLotCalculator.cs#9-692) としてください。
3.  作成されたファイルのコードを全削除し、今回提供した [AutoLotCalculator.cs](file:///C:/Users/jf08/.gemini/antigravity/brain/4ed089b8-5f02-4200-a967-79e572b525cf/AutoLotCalculator.cs) の中身を全て貼り付けます。
4.  「**Build**」ボタンを押してビルドします。エラーが出ないことを確認してください。

## 使い方

### 1. チャートへの適用
- チャート上で右クリック -> `cBotを追加` -> [AutoLotCalculator](file:///C:/Users/jf08/.gemini/antigravity/brain/4ed089b8-5f02-4200-a967-79e572b525cf/AutoLotCalculator.cs#9-692) を選択します。
- パラメータ設定画面が表示されます。
  - **リスク許容率 (%)**: 口座残高の何%を1トレードのリスクにするか設定します（デフォルト 1.0%）。
  - **マジックナンバー**: このBotの注文を識別するためのIDです。

### 2. UIの操作
Botを開始すると、チャート上に操作パネルとラインが表示されます。

- **モード切替**: 「モード: 成行」ボタンを押すと「指値」モードに切り替わります。
  - **成行モード (Market)**: 現在価格で即時エントリーします。SLラインのみを動かしてリスクを調整します（TPは自動追従しますが、必要ならコード調整可）。
  - **指値モード (Pending)**: 金色の「Entry Line」が現れます。エントリー価格、SL、TPをすべて自由に動かして、予約注文（Limit/Stop）を設定できます。
- **UI表示/非表示**: 左上の「UIを隠す」ボタンでパネルと全ラインを一時的に隠せます。
- **分割モード**: 指値モード時のみ有効。「分割: ON」にすると、エントリーラインを中心に上下に分割エントリー用の破線が表示されます（Shallow/Deep）。

### 3. 発注
パネル上の緑色のボタンで発注します。ボタンには現在の設定に基づいた「売買方向」と「計算されたロット数」が表示されています。

- **Full Entry**: 計算された適正ロット数で発注します。
- **1/2 Entry**: ロット数を半分にして発注します。
- **1/3 Entry**: ロット数を1/3にして発注します。

> [!WARNING]
> cTraderの「Tick Value」や「最小ロット単位」の仕様により、計算結果が0になる場合、ボタンを押しても発注されずログに警告が出ます。

### 4. 決済
- **全ポジション決済**: このBotが持った全てのポジションを即時決済します。他の手動注文や別EAのポジションは閉じません（マジックナンバーで識別）。
