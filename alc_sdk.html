<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>ALC WebView Scan</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 10px;
        }

        .status {
            padding: 10px;
            border: 1px solid #0f0;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
        }

        .log {
            font-size: 10px;
            border-bottom: 1px solid #330033;
            padding: 2px;
            word-break: break-all;
            color: #ccc;
        }
    </style>

    <script>
        // --- UTILS ---
        window.logBuffer = [];
        window.pushLog = (msg) => {
            const line = `[${new Date().toLocaleTimeString().split(' ')[0]}] ${msg}`;
            window.logBuffer.unshift(line);
            console.log(line);
            const el = document.getElementById('logs');
            if (el) {
                const div = document.createElement('div');
                div.className = "log";
                div.textContent = line;
                el.insertBefore(div, el.firstChild);
            }
        };

        window.updateStatus = (msg) => {
            const el = document.getElementById('status');
            if (el) el.textContent = msg;
        };

        // --- INSPECTION ---
        window.inspectWebview = () => {
            window.pushLog("--- INSPECTING window.android.webview ---");

            if (!window.android || !window.android.webview) {
                window.pushLog("CRITICAL: window.android.webview NOT FOUND");
                return;
            }

            const wv = window.android.webview;

            // 1. Direct Keys
            try {
                const keys = [];
                for (let k in wv) keys.push(k);
                window.pushLog(`KEYS: ${keys.join(', ') || 'NONE'}`);
            } catch (e) { window.pushLog("Keys Err: " + e.message); }

            // 2. Proto Keys
            try {
                const proto = Object.getPrototypeOf(wv);
                if (proto) {
                    const pKeys = Object.getOwnPropertyNames(proto);
                    window.pushLog(`PROTO KEYS: ${pKeys.join(', ') || 'NONE'}`);

                    // Check types
                    pKeys.forEach(k => {
                        try {
                            window.pushLog(`  > ${k}: ${typeof wv[k]}`);
                        } catch (e) { }
                    });
                }
            } catch (e) { window.pushLog("Proto Err: " + e.message); }

            window.pushLog("---------------------------------------");
        };

        // --- SPRAYER (Webview Edition) ---
        window.sprayWebview = (msgId) => {
            window.updateStatus("SPRAYING window.android.webview...");
            const wv = window.android?.webview;
            if (!wv) return;

            const payload = {
                payloadType: 2001,
                clientMsgId: msgId,
                payload: {}
            };
            const strPayload = JSON.stringify(payload);

            // Potential method names
            const candidates = ['postMessage', 'sendMessage', 'send', 'onMessage', 'dispatch'];

            candidates.forEach(m => {
                if (typeof wv[m] === 'function') {
                    try {
                        wv[m](strPayload);
                        window.pushLog(`>> SENT wv.${m}(Str)`);
                    } catch (e) { }
                    try {
                        wv[m](payload);
                        window.pushLog(`>> SENT wv.${m}(Obj)`);
                    } catch (e) { }
                }
            });
        };

        // --- HANDLER ---
        window.onHostMessage = (msg) => {
            if (!msg) return;

            if (msg.payloadType === 2000) {
                window.pushLog(`<< RECV 2000 (ID: ${msg.clientMsgId})`);
                window.inspectWebview();
                window.sprayWebview(msg.clientMsgId);
            }
            else if (msg.payloadType === 2101 || msg.payloadType === 2500) {
                window.updateStatus("CONNECTED! RECV DATA!");
                window.pushLog(`!!! SUCCESS !!! data: ${JSON.stringify(msg)}`);
            }
        };

        // --- SETUP ---
        window.onload = () => {
            window.pushLog("Inspector v18 Ready.");
            window.inspectWebview(); // Run once at start too

            window.addEventListener('message-from-host', (e) => window.onHostMessage(e.data));
            window.addEventListener('message', (e) => {
                if (e.data && e.data.payloadType) window.onHostMessage(e.data);
            });
        };

    </script>
</head>

<body>
    <div id="status" class="status">WAITING FOR 2000...</div>

    <p style="font-size:12px; text-align:center; color:#555;">
        Inspector v18: Sub-Bridge Scan
    </p>

    <div id="logs" style="margin-top:10px;"></div>

    <script>
        setTimeout(() => {
            if (window.logBuffer.length > 0) {
                const el = document.getElementById('logs');
                if (el && el.innerHTML === "") {
                    window.logBuffer.forEach(l => {
                        const d = document.createElement('div');
                        d.className = "log";
                        d.textContent = l;
                        el.appendChild(d);
                    });
                }
            }
        }, 500);
    </script>
</body>

</html>